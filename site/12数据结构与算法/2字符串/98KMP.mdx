# KMP

[ğŸ”— LeetCode](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/)

## æœ´ç´ æ¨¡å¼åŒ¹é…

å°±æ˜¯æš´åŠ›å¾ªç¯çš„è§£æ³•

å°†æ–‡æœ¬ä¸²éå†çš„åŒæ—¶æ‰¾åˆ°ä¸æ¨¡å¼ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸ç­‰çš„å­—ç¬¦ï¼Œå¼€å§‹å°è¯•åŒ¹é…

éå†æ¨¡å¼ä¸²è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœéå†å®Œäº†éƒ½ç›¸ç­‰å°±æ˜¯åŒ¹é…æˆåŠŸï¼Œå¦‚æœæœ‰ä¸ç›¸ç­‰åˆ™åŒ¹é…å¤±è´¥

å¤±è´¥åç»§ç»­éå†æ–‡æœ¬ä¸²ï¼Œä¸‹æ¬¡åŒ¹é…åˆ™ä»æ¨¡å¼ä¸²çš„å¼€å¤´å¼€å§‹ï¼Œè¿™å°±æ˜¯å›æº¯åˆ° 0 ä¸‹æ ‡

è€Œæ–‡æœ¬ä¸²ä¹Ÿæ²¡æœ‰éšæ¨¡å¼ä¸²éå†ä¸€èµ·éå†ï¼Œä¹Ÿæ˜¯å±äºå›æº¯äº†

KMP ç®—æ³•å°±æ˜¯è§£å†³è¿™ä¸ªæ¨¡å¼ä¸²å›æº¯é•¿åº¦çš„é—®é¢˜ï¼Œå¹¶ä¸”è¿˜åŠ å¿«äº†éå†æ–‡æœ¬ä¸²ï¼Œä¸ç”¨ç­‰å¾…æ¨¡å¼ä¸²éå†ï¼Œä¸€èµ·éå†

```ts
function strStr(haystack: string, needle: string): number {
  for (let i = 0; i < haystack.length; i++) {
    if (haystack[i] === needle[0]) {
      let j = 0

      for (; j < needle.length && haystack[i + j] === needle[j]; j++) {}

      if (j === needle.length) {
        return i
      }
    }
  }

  return -1
}
```

## KMP

è§£å†³äº†ä¸¤ä¸ªå›æº¯çš„é—®é¢˜ï¼š

- æ¨¡å¼ä¸²å›æº¯é—®é¢˜ï¼šé€šè¿‡æå‰å‡†å¤‡çš„ next æ•°ç»„è¿›è¡Œå›æº¯è€Œä¸æ˜¯ç›´æ¥å›æº¯åˆ° 0
- æ–‡æœ¬ä¸²å›æº¯é—®é¢˜ï¼šæ¨¡å¼ä¸²ä¸æ–‡æœ¬ä¸²ä¸€èµ·éå†æé«˜æ•ˆç‡

éš¾ç‚¹å°±åœ¨ next æ•°ç»„çš„å‡†å¤‡ä¸Š

## next æ•°ç»„

next æ•°ç»„å°±æ˜¯æœ€é•¿ç›¸åŒå‰åç¼€è¡¨ï¼Œä¹Ÿå¯ä»¥å«å‰ç¼€å’Œè¡¨

next æ•°ç»„æ˜¯ç”¨æ¥å›é€€çš„ï¼Œå®ƒè®°å½•äº†æ¨¡å¼ä¸²ä¸æ–‡æœ¬ä¸²ä¸åŒ¹é…çš„æ—¶å€™ï¼Œæ¨¡å¼ä¸²åº”è¯¥ä»å“ªé‡Œå¼€å§‹é‡æ–°åŒ¹é…

next æ•°ç»„çš„ä¸‹æ ‡å°±æ˜¯å½“å‰æ¨¡å¼ä¸²å­—ç¬¦ä¸‹æ ‡

next æ•°ç»„çš„å€¼å°±æ˜¯å½“å‰å­—ç¬¦ä¸²(åŒ…æ‹¬è‡ªå·±)çš„æœ€é•¿ç›¸åŒå‰åç¼€å€¼

> ç¬¬ä¸€ä½æ°¸è¿œæ˜¯ 0 å› ä¸ºä¸€ä¸ªå­—ç¬¦æ²¡æœ‰å‰åç¼€

### æœ€é•¿ç›¸åŒå‰åç¼€

- å‰ç¼€å°±æ˜¯æœ€åå­—ç¬¦å¤–çš„å‰é¢çš„å­ä¸²
- åç¼€å°±æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦å¤–çš„åé¢çš„å­ä¸²

æœ€é•¿ç›¸åŒå‰åç¼€å°±æ˜¯å‰ç¼€åç¼€ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæœ€é•¿çš„å‰ç¼€/åç¼€

å¦‚ aabaa

æœ€é•¿ç›¸åŒå‰åç¼€å°±æ˜¯ aa

å¦‚ aabaaab

æœ€é•¿ç›¸åŒå‰åç¼€è¡¨å°±æ˜¯`[0,1,0,1,2,2,3]`

### ä½¿ç”¨ next æ•°ç»„åŒ¹é…

å¦‚æœåŒ¹é…æ–‡æœ¬ä¸² aabaabaafaï¼Œæ¨¡å¼ä¸² aabaaf

å¯¹åº” next æ˜¯`[0,1,0,1,2,0]`

aabaab aafa
aabaaf

å› ä¸º aabaaf åŒ¹é…åˆ° f æ—¶å¤±è´¥ï¼Œf ä¹‹å‰çš„å­—ç¬¦ä¸²ä¸º aabaaï¼Œå…¶æœ€é•¿ç›¸åŒå‰åç¼€ä¸º aa

é‚£ä¹ˆ next è¡¨ä¸­ f å›é€€å¯¹åº”çš„ä½ç½®å°±æ˜¯ b

aabaabaafa
---aabaaf

é‚£ä¸ºä»€ä¹ˆå›é€€åˆ° b å°±å¯ä»¥ç»§ç»­åŒ¹é…äº†

ä½ çœ‹ï¼Œ`aab[aa]baafa`æ‹¬å·ä¸­çš„ aa åœ¨åŒ¹é…æ—¶åŒ¹é…çš„æ˜¯`aab[aa]f`ä¸­æ‹¬å·çš„ aa

å› ä¸ºæ‹¬å·ä¸­çš„ `aab[aa]f` ä¸º f å‰é¢å­—ç¬¦ä¸²çš„åç¼€ï¼Œå…¶å…·æœ‰ç›¸åŒå‰ç¼€`[aa]baaf`

é‚£ä¸å°±æ˜¯ä¹ŸåŒ¹é…è¿‡`[aa]baaf`ä¸­çš„ aa äº†å—

é‚£è‡ªç„¶ä» b å¼€å§‹äº†

æ€ä¹ˆåœ¨ next æ•°ç»„ä¸­æ‰¾åˆ° b çš„ä½ç½®å‘¢

f åŒ¹é…å¤±è´¥ååº”è¯¥ä» next[fIndex-1]ä½ç½®æ‰¾

aabaa å­—ç¬¦ä¸²å¯¹åº”çš„å€¼ä¸º 2

f åœ¨ fIndex-1 ä½ç½®æ‰¾æ˜¯å› ä¸º f æ‰¾çš„æ˜¯ aabaa çš„å¯¹åº”å‰ç¼€å’Œ

2 å†å›åˆ°`aabaaf`ä¸­å°±æ˜¯ b äº†

### å®ç° next æ•°ç»„

```ts
function getNext(needle: string) {
  let next = [0]
  // jä¸ºå‰ç¼€å°¾éƒ¨ä¸‹æ ‡ï¼Œnextæ•°ç»„å†…çš„å€¼æœ¬è´¨å°±æ˜¯jè¿™ä¸ªå‰ç¼€ä¸‹æ ‡
  let j = 0

  // iä¸ºåç¼€å°¾éƒ¨ä¸‹æ ‡ï¼Œä¸”éå†æ¨¡å¼ä¸²
  for (let i = 1; i < needle.length; i++) {
    // ä¸åŒåˆ™å‰ç¼€å›é€€åˆ°ç›¸åŒçš„æ—¶å€™
    while (j > 0 && needle[j] !== needle[i]) {
      j = next[j - 1]
    }
    // ç›¸åŒåˆ™å‰ç¼€åŠ ä¸€
    if (needle[j] === needle[i]) {
      j++
    }

    next[i] = j
  }

  return next
}
```

## è§£å†³æ¨¡å¼ä¸²å›æº¯é—®é¢˜

```ts
function strStr(haystack: string, needle: string): number {
  const next = getNext(needle)
  let j = 0 // æåˆ°å…¨å±€

  for (let i = 0; i < haystack.length; i++) {
    if (haystack[i] === needle[j]) {
      for (; j < needle.length && haystack[i + j] === needle[j]; j++) {}

      if (j === needle.length) {
        return i
      } else {
        // åªéœ€è¦åœ¨æ¯æ¬¡åŒ¹é…å¤±è´¥æ—¶ä½¿ç”¨nextæ•°ç»„å›é€€å°±è¡Œ
        j = next[j - 1]
      }
    }
  }

  return -1
}

function getNext(needle: string) {
  let next = [0]
  // jä¸ºå‰ç¼€å°¾éƒ¨ä¸‹æ ‡
  let j = 0

  // iä¸ºåç¼€å°¾éƒ¨ä¸‹æ ‡ï¼Œä¸”éå†æ¨¡å¼ä¸²
  for (let i = 1; i < needle.length; i++) {
    // ä¸åŒåˆ™å‰ç¼€å›é€€åˆ°ç›¸åŒçš„æ—¶å€™
    while (j > 0 && needle[j] !== needle[i]) {
      j = next[j - 1]
    }
    // ç›¸åŒåˆ™å‰ç¼€åŠ ä¸€
    if (needle[j] === needle[i]) {
      j++
    }

    next[i] = j
  }

  return next
}
```

## è§£å†³æ–‡æœ¬ä¸²å›æº¯é—®é¢˜

```ts
function strStr(haystack: string, needle: string): number {
  const next = getNext(needle)
  let j = 0

  for (let i = 0; i < haystack.length; i++) {
    while (j > 0 && haystack[i] !== needle[j]) {
      j = next[j - 1]
    }

    if (haystack[i] === needle[j]) {
      j++
    }

    if (j === needle.length) {
      return i - (j - 1)
    }
  }

  return -1
}

function getNext(needle: string) {
  let next = [0]
  // jä¸ºå‰ç¼€å°¾éƒ¨ä¸‹æ ‡
  let j = 0

  // iä¸ºåç¼€å°¾éƒ¨ä¸‹æ ‡ï¼Œä¸”éå†æ¨¡å¼ä¸²
  for (let i = 1; i < needle.length; i++) {
    // ä¸åŒåˆ™å‰ç¼€å›é€€åˆ°ç›¸åŒçš„æ—¶å€™
    while (j > 0 && needle[j] !== needle[i]) {
      j = next[j - 1]
    }
    // ç›¸åŒåˆ™å‰ç¼€åŠ ä¸€
    if (needle[j] === needle[i]) {
      j++
    }

    next[i] = j
  }

  return next
}
```
