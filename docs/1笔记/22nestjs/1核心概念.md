# 核心概念

## IoC

IoC (控制反转)是 nestjs 的依赖注入机制

```ts
@Module({
  imports: [],
  controllers: [AppController],
  providers: [AppService],
})
```

@Module 声明模块，它包含 controllers 和 providers

为什么 controllers 对应 AppController，但是是 providers 对应的是 AppService，就是因为 nestjs 实现了 IoC

通过 @Inject 声明依赖，不需要手动去 new 依赖，就可以就可以使用

```ts
@Module({
  providers: [
    {
      provide: "DATABASE_CONNECTION",
      useValue: { host: "localhost", port: 3306 },
    },
  ],
})
@Injectable()
export class UserService {
  constructor(@Inject("DATABASE_CONNECTION") private dbConfig: any) {}
}
```

上面是构造器注入，还有属性注入

## MVP

- dto 是封装请求参数的

- controller 是处理路由，解析请求参数的

- service 是处理业务逻辑的，比如操作数据库

- entities 是封装对应数据库表的实体的

nest 应用跑起来后，会从 AppModule 开始解析，初始化 IoC 容器，加载所有的 service 到容器里，然后解析 controller 里的路由，接下来就可以接收请求了，收到后会解析 dto 参数

这种架构就叫做 MVC 模式，也就是 **model、view、controller**

**view**发起请求，**controller** 接受请求按照 dto 处理参数后，交给 service 处理，service 和数据库就代表着 **model**

## AOP

如果是多个 controller，在 Nest 提供了 AOP （Aspect Oriented Programming 面向切面编程）的机制

具体来说，有

- Middleware
- Guard
- Interceptor
- Pipe
- Exception Filter

这五种
