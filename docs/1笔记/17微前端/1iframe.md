# iframe

## 浏览器

### 浏览器是多进程架构

主进程、渲染进程、网络进程、插件进程等

每一个 tab 页面也基本是一个进程

每个进程复用操作系统的沙箱技术进行隔离

进程之间通过 ipc 通信

多进程防止了浏览器因为某一部分或者页面出问题而崩溃

### 浏览器站点隔离

浏览器通过同源策略来限制不同源的页面

> 同源为同协议、域名、端口

tab 页不同进程后，又通过同站限制页面是否共用进程

> 同站为同协议、顶级域名

为什么不使用同源呢，因为可以让同站应用使用 document.domain（已弃用）等通信

## 浏览器上下文

每一个 iframe 都有自己的浏览器上下文

访问 window.top 可以获取当前浏览上下文的 window 对象，通过访问 window.parent 可以获取父浏览上下文的 window 对象

`if(window.top !== window) {}`可以判断是否是在 iframe

## 方案

导航切换的设计方案可以是前端框架路由、服务端路由和自己设计的切换逻辑

在 iframe 的方案中，导航设计可以是前端框架路由来控制不同微应用所在 iframe 的显示和隐藏

但是首次加载 iframe 应用时，都会因为服务端请求而导致内容区带来短暂的白屏效果

优点：

- 站点隔离和浏览上下文隔离，适合集成三方应用
- 移植性和复用性好，可以便捷地嵌在不同的主应用中

缺点：

- 主应用刷新时， iframe 无法保持 URL 状态（会重新加载 src 对应的初始 URL）
- 主应用和 iframe 处于不同的浏览上下文，无法使 iframe 中的模态框相对于主应用居中
- 主应用和 iframe 微应用的数据状态同步问题：持久化数据和通信

### 主应用和微应用的免登问题

通过主应用和微应用共享 Cookie 进行处理
